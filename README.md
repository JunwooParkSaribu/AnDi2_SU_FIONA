# AnDi2_SU_FIONA

> [!IMPORTANT]  
> Requirements </br>
> - TensorFlow 2.14.1[^6]
> - Python 3.10 or higher
> - latest version of [scikit-learn](https://scikit-learn.org/stable/)[^3]
> - latest version of [scikit-image](https://scikit-image.org/docs/stable/user_guide/install.html)[^4]

<b>*** This is a preset version of ___ for [AnDi2 Challenge](http://andi-challenge.org/challenge-2024/#andi2seminar). ***</b></br>
To check the latest version of the software, [click here](http://google.com).</br>

___ detects changepoints from molecular trajectory following fBm which has two properties, Anomalous exponent and Generalized diffusion coefficient, on different scenarios.</br>
For the details of used data and scenarios, please check Andi2 Challenge[^1][^2] description of above link.

<h2>Visualized examples of changepoint detection from molecular trajectories</h2>
<table border="0"> 
        <tr> 
            <td>QTM</td> 
            <td><img src="https://github.com/JunwooParkSaribu/AnDi2_SU_FIONA/blob/main/tmps/imgs/qtm_0.gif" width="128" height="128"></td> 
            <td><img src="https://github.com/JunwooParkSaribu/AnDi2_SU_FIONA/blob/main/tmps/imgs/qtm_1.gif" width="128" height="128"></td>
            <td><img src="https://github.com/JunwooParkSaribu/AnDi2_SU_FIONA/blob/main/tmps/imgs/qtm_2.gif" width="128" height="128"></td> 
            <td><img src="https://github.com/JunwooParkSaribu/AnDi2_SU_FIONA/blob/main/tmps/imgs/qtm_3.gif" width="128" height="128"></td>
            <td><img src="https://github.com/JunwooParkSaribu/AnDi2_SU_FIONA/blob/main/tmps/imgs/qtm_4.gif" width="128" height="128"></td> 
        </tr> 
        <tr> 
            <td>TCM</td> 
            <td><img src="https://github.com/JunwooParkSaribu/AnDi2_SU_FIONA/blob/main/tmps/imgs/tcm_0.gif" width="128" height="128"></td> 
            <td><img src="https://github.com/JunwooParkSaribu/AnDi2_SU_FIONA/blob/main/tmps/imgs/tcm_1.gif" width="128" height="128"></td>
            <td><img src="https://github.com/JunwooParkSaribu/AnDi2_SU_FIONA/blob/main/tmps/imgs/tcm_2.gif" width="128" height="128"></td> 
            <td><img src="https://github.com/JunwooParkSaribu/AnDi2_SU_FIONA/blob/main/tmps/imgs/tcm_3.gif" width="128" height="128"></td>
            <td><img src="https://github.com/JunwooParkSaribu/AnDi2_SU_FIONA/blob/main/tmps/imgs/tcm_4.gif" width="128" height="128"></td> 
        </tr>
        <tr> 
            <td>DIM</td> 
            <td><img src="https://github.com/JunwooParkSaribu/AnDi2_SU_FIONA/blob/main/tmps/imgs/dim_0.gif" width="128" height="128"></td> 
            <td><img src="https://github.com/JunwooParkSaribu/AnDi2_SU_FIONA/blob/main/tmps/imgs/dim_1.gif" width="128" height="128"></td>
            <td><img src="https://github.com/JunwooParkSaribu/AnDi2_SU_FIONA/blob/main/tmps/imgs/dim_2.gif" width="128" height="128"></td> 
            <td><img src="https://github.com/JunwooParkSaribu/AnDi2_SU_FIONA/blob/main/tmps/imgs/dim_3.gif" width="128" height="128"></td>
            <td><img src="https://github.com/JunwooParkSaribu/AnDi2_SU_FIONA/blob/main/tmps/imgs/dim_4.gif" width="128" height="128"></td> 
        </tr>
        <tr> 
            <td>MSM</td> 
            <td><img src="https://github.com/JunwooParkSaribu/AnDi2_SU_FIONA/blob/main/tmps/imgs/msm_0.gif" width="128" height="128"></td> 
            <td><img src="https://github.com/JunwooParkSaribu/AnDi2_SU_FIONA/blob/main/tmps/imgs/msm_1.gif" width="128" height="128"></td>
            <td><img src="https://github.com/JunwooParkSaribu/AnDi2_SU_FIONA/blob/main/tmps/imgs/msm_2.gif" width="128" height="128"></td> 
            <td><img src="https://github.com/JunwooParkSaribu/AnDi2_SU_FIONA/blob/main/tmps/imgs/msm_3.gif" width="128" height="128"></td>
            <td><img src="https://github.com/JunwooParkSaribu/AnDi2_SU_FIONA/blob/main/tmps/imgs/msm_4.gif" width="128" height="128"></td> 
        </tr>  
</table>
<img src="https://github.com/JunwooParkSaribu/AnDi2_SU_FIONA/blob/main/tmps/imgs/foot.png" width="164" height="52"></br>

___ detects changes of anomalous exponent(alpha) / diffusion coefficient(K) in a single molecular trajectory level. 

<h3> Brief description of method </h3>

At first, ___ builds prior distribution of alpha, K by splitting a trajectory into a subset of sub-trajectories with multiple sliding windows. Each sub-trajectory contains two potential changepoints at extremities, ___ estimates alpha and K for each sub trajectory, then determine the potential changepoints between two sub-trajectories whether they are true positives or false positives by clustered prior distribution with GMM[^3]. The threshold of a signal generated by multiple sliding windows controls the number of false negative changepoints, and also determine the computational time. </br>
___ has three major parameters to tune the quality of result, </br>
<b>(1) A threshold of the signal</b></br> 
<b>(2) Sizes of sliding windows</b></br>
<b>(3) Number of states</b> in the prior distribution.</br>
(1) acts as FN controller. low threshold decrease FN, but increase time complexity. (2) is related to the transition probability between trajectory-states. When the transition events occur frequently, it needs to use small sizes of sliding windows and vice versa. (3) is related to the hidden number of states of molecular trajectories. The default parameters of (1), (2) are sufficient in general cases, however (3) need to be carefully chosen since it may produce many FP if we select too high number of states. To help choosing the number of sates for (3), we generate a plot of prior distribution after building it. then, we can select its number (2/3 in general cases). The estimations of alpha and K are done with ConvLSTM[^5] and Dense layers[^6].

</br>

> [!NOTICE]  
> ___ takes around 1hr for the inference of 1,000 trajectories with default settings on a single L4/RTX3090 chip. </br>


<h3> To remake a result on AnDi2 dataset </h3>

1. Clone the repository.</br>
2. Download pre-trained models from here, place the models folder inside of the cloned folder.</br>
3. Run run_process script with python.</br>


<h3> References </h3>

[^1]: [AnDi datasets](https://doi.org/10.5281/zenodo.10259556)
[^2]: Quantitative evaluation of methods to analyze motion changes in single-particle experiments, Gorka Mu√±oz-Gil et al. 2024 [https://arxiv.org/abs/2311.18100](https://arxiv.org/abs/2311.18100)
[^3]: Scikit-learn, Machine Learning in Python, Pedregosa et al., JMLR 12, pp. 2825-2830, 2011.
[^4]: Scikit-image, Image processing in Python. PeerJ 2:e453 (2014) [https://doi.org/10.7717/peerj.453](https://doi.org/10.7717/peerj.453)
[^5]: Convolutional LSTM Network, A Machine Learning Approach for Precipitation Nowcasting, Xingjian Shi et al. 2015 [https://arxiv.org/abs/1506.04214](https://arxiv.org/abs/1506.04214)
[^6]: TensorFlow, Large-scale machine learning on heterogeneous systems, 2015
